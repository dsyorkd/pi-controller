apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: pwmcontrollers.gpio.pi-controller.io
  annotations:
    controller-gen.kubebuilder.io/version: v0.13.0
spec:
  group: gpio.pi-controller.io
  versions:
  - name: v1
    served: true
    storage: true
    schema:
      openAPIV3Schema:
        type: object
        description: PWMController is the Schema for the pwmcontrollers API
        properties:
          apiVersion:
            type: string
            description: 'APIVersion defines the versioned schema of this representation of an object.'
          kind:
            type: string
            description: 'Kind is a string value representing the REST resource this object represents.'
          metadata:
            type: object
          spec:
            type: object
            description: PWMControllerSpec defines the desired state of PWMController
            properties:
              nodeSelector:
                type: object
                description: NodeSelector specifies which node this PWM controller should be managed on
                additionalProperties:
                  type: string
              channels:
                type: array
                description: Channels defines the PWM channels to configure
                items:
                  type: object
                  properties:
                    pinNumber:
                      type: integer
                      description: PinNumber is the GPIO pin number for this PWM channel
                      minimum: 0
                      maximum: 40
                    frequency:
                      type: integer
                      description: Frequency sets the PWM frequency in Hz
                      minimum: 1
                      maximum: 100000
                    dutyCycle:
                      type: number
                      description: DutyCycle sets the PWM duty cycle as percentage (0-100)
                      minimum: 0
                      maximum: 100
                    enabled:
                      type: boolean
                      description: Enabled controls whether this PWM channel is active
                      default: true
                    phase:
                      type: number
                      description: Phase sets the PWM phase offset in degrees (0-360)
                      minimum: 0
                      maximum: 360
                      default: 0
                  required:
                  - pinNumber
                  - frequency
                  - dutyCycle
              globalSettings:
                type: object
                description: GlobalSettings configures controller-wide PWM settings
                properties:
                  clockDivider:
                    type: integer
                    description: ClockDivider sets the base clock divider
                    minimum: 1
                    maximum: 4095
                    default: 32
                  range:
                    type: integer
                    description: Range sets the PWM range (resolution)
                    minimum: 1
                    maximum: 4096
                    default: 1024
            required:
            - nodeSelector
            - channels
          status:
            type: object
            description: PWMControllerStatus defines the observed state of PWMController
            properties:
              phase:
                type: string
                description: Phase represents the current lifecycle phase
                enum:
                - Pending
                - Configuring
                - Ready
                - Failed
              nodeId:
                type: string
                description: NodeID is the ID of the node managing this PWM controller
              activeChannels:
                type: integer
                description: ActiveChannels is the number of currently active PWM channels
              channelStatus:
                type: array
                description: ChannelStatus provides status for each PWM channel
                items:
                  type: object
                  properties:
                    pinNumber:
                      type: integer
                      description: PinNumber identifies the GPIO pin
                    actualFrequency:
                      type: integer
                      description: ActualFrequency is the currently configured frequency
                    actualDutyCycle:
                      type: number
                      description: ActualDutyCycle is the currently configured duty cycle
                    enabled:
                      type: boolean
                      description: Enabled indicates if the channel is currently active
                    lastError:
                      type: string
                      description: LastError contains the last error message for this channel
              lastUpdated:
                type: string
                format: date-time
                description: LastUpdated is the timestamp of the last status update
              conditions:
                type: array
                description: Conditions represent the current service state
                items:
                  type: object
                  properties:
                    type:
                      type: string
                      description: Type of condition
                    status:
                      type: string
                      description: Status of the condition (True, False, Unknown)
                      enum:
                      - "True"
                      - "False"
                      - "Unknown"
                    lastTransitionTime:
                      type: string
                      format: date-time
                      description: Last time the condition transitioned
                    reason:
                      type: string
                      description: Reason for the condition's last transition
                    message:
                      type: string
                      description: Human readable message indicating details
                  required:
                  - type
                  - status
              message:
                type: string
                description: Message provides additional information about the current state
    additionalPrinterColumns:
    - name: Node
      type: string
      jsonPath: .status.nodeId
    - name: Channels
      type: integer
      jsonPath: .status.activeChannels
    - name: Phase
      type: string
      jsonPath: .status.phase
    - name: Age
      type: date
      jsonPath: .metadata.creationTimestamp
  scope: Namespaced
  names:
    plural: pwmcontrollers
    singular: pwmcontroller
    kind: PWMController
    shortNames:
    - pwm
    categories:
    - pi-controller